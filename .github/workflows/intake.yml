name: Intake Form Receiver

on:
  workflow_dispatch:
    inputs:
      title:
        description: "Project title"
        required: true
        type: string
      maturity:
        description: "Maturity level"
        required: true
        type: string
      ministry:
        description: "Ministry or agency"
        required: true
        type: string
      problem:
        description: "Problem statement"
        required: true
        type: string
      description:
        description: "Project description"
        required: true
        type: string
      tech:
        description: "Technology (optional)"
        required: false
        type: string
      contact:
        description: "Contact email"
        required: true
        type: string

permissions:
  contents: write
  issues: write

jobs:
  create_issue:
    runs-on: ubuntu-latest

    steps:
      - name: Create GitHub Issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TITLE: ${{ github.event.inputs.title }}
          MATURITY: ${{ github.event.inputs.maturity }}
          MINISTRY: ${{ github.event.inputs.ministry }}
          PROBLEM: ${{ github.event.inputs.problem }}
          DESCRIPTION: ${{ github.event.inputs.description }}
          TECH: ${{ github.event.inputs.tech }}
          CONTACT: ${{ github.event.inputs.contact }}
        run: |
          printf "**Maturity:** %s\n" "$MATURITY" > body.txt
          printf "**Ministry:** %s\n\n" "$MINISTRY" >> body.txt

          printf "**Problem Statement:**\n%s\n\n" "$PROBLEM" >> body.txt
          printf "**Project Description:**\n%s\n\n" "$DESCRIPTION" >> body.txt
          printf "**Tech:**\n%s\n\n" "$TECH" >> body.txt

          printf "**Contact:** %s\n" "$CONTACT" >> body.txt

          gh issue create \
            --title "$TITLE" \
            --body-file body.txt \
            --label "ai-initiative" \
            --repo "$GITHUB_REPOSITORY"
